Attached is the .c file , proteus simulation file and a snippet from proteus
